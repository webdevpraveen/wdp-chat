<!DOCTYPE html>
<html>
<head>
    <title>SRMU Web Chat</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
    --bg:#f1f4f8;
    --panel:#ffffff;
    --self:#d8f8d2;
    --other:#e6f0ff;
    --admin:#ffe6e6;
    --welcome:#fff7cc;
    --radius:14px;
    --accent:#2b7cff;
    --text:#1c1f23;
}

body{
    margin:0; background:var(--bg);
    font-family:Inter,Arial; color:var(--text);
    display:flex; justify-content:center; align-items:center;
    height:100vh;
}

.chat-box{
    width:100%; max-width:900px;
    height:90vh;
    background:var(--panel);
    border-radius:12px;
    box-shadow:0 8px 28px rgba(10,20,40,0.1);
    display:flex; flex-direction:column;
    overflow:hidden;
}

/* HEADER */
.header{
    padding:12px 18px;
    display:flex; justify-content:space-between;
    align-items:center;
    border-bottom:1px solid #e4e8ee;
}

.header-left{
    display:flex; flex-direction:column;
    gap:2px;
}

.app-title{
    font-size:20px; font-weight:700;
    text-align:center;
}

.you-id{
    font-size:13px; color:#6a7685;
}

.header-right{
    display:flex; align-items:center; gap:18px;
}

.github-icon{
    cursor:pointer; font-size:26px;
}

/* ONLINE POPUP */
.online-popup{
    position:absolute; top:60px; right:16px;
    background:#fff; padding:12px; border-radius:12px;
    width:200px; box-shadow:0 8px 30px rgba(0,0,0,0.1);
    display:none;
}
.online-popup div{
    padding:6px 4px;
    border-bottom:1px solid #eee;
}

/* PINNED */
#pinnedBar{
    background:#f6f8fb;
    padding:10px 14px;
    border-bottom:1px solid #e8edf3;
    display:none;
}

/* CHAT */
.messages{
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex; flex-direction:column;
    gap:12px;
}

/* EVENT */
.event{
    text-align:center; color:#7d8793;
}

/* BUBBLES */
.row{ display:flex; }
.left{ justify-content:flex-start; }
.right{ justify-content:flex-end; }

.bubble{
    max-width:70%;
    padding:12px 14px;
    border-radius:var(--radius);
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

.self{ background:var(--self); }
.other{ background:var(--other); }
.admin{ background:var(--admin); border-left:4px solid #ff6b6b; }
.welcome{ background:var(--welcome); }

/* META */
.meta{
    display:flex; justify-content:space-between;
    font-size:12px; color:#6a6e75; margin-bottom:6px;
}

/* COMPOSER */
.composer{
    padding:12px; border-top:1px solid #e4e8ee;
    display:flex; gap:10px;
}

.composer input{
    flex:1; padding:12px;
    border-radius:999px;
    border:1px solid #dce2ea;
}

.composer button{
    padding:12px 16px;
    border:none; border-radius:999px;
    background:var(--accent); color:#fff;
    font-weight:600;
}
</style>
</head>

<body>

<div class="chat-box">

    <div class="header">
        
        <div class="header-left">
            <div class="app-title">SRMU Web Chat</div>
            <div id="youId" class="you-id"></div>
        </div>

        <div class="header-right">
            <a href="https://github.com/webdevpraveen" target="_blank" class="github-icon">üêô</a>
            <div id="onlineCount" style="font-weight:600; cursor:pointer;">0 online</div>
        </div>

    </div>

    <div id="onlinePopup" class="online-popup"></div>

    <div id="pinnedBar"><b>üìå</b> <span id="pinnedText"></span></div>

    <div class="messages" id="messages"></div>

    <div class="composer">
        <input id="input" placeholder="Type your message..." />
        <button id="send">Send</button>
    </div>

</div>

<audio id="notifSound" src="notification.mp3"></audio>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io("https://wdp-chat.onrender.com");

let userId = localStorage.getItem("userId");
if(!userId){
    userId = "User-" + Math.floor(10000 + Math.random()*90000);
    localStorage.setItem("userId", userId);
}

document.getElementById("youId").textContent = "You are: " + userId;

/* CONNECT */
socket.on("connect", ()=> socket.emit("userConnected", userId));

/* SEND */
send.onclick = ()=>{
    let v = input.value.trim();
    if(!v) return;

    socket.emit("chatMessage", { userId, text:v });
    input.value="";
};

/* RECEIVE */
socket.on("chatMessage",(msg)=>{

    const row = document.createElement("div");
    row.className = "row " + (msg.userId===userId?"right":"left");

    const b = document.createElement("div");
    b.className = "bubble";

    if(msg.isWelcome) b.classList.add("welcome");
    else if(msg.userId === userId) b.classList.add("self");
    else if(msg.userId === "System") b.classList.add("welcome");
    else b.classList.add("other");

    let meta = document.createElement("div");
    meta.className = "meta";

    meta.innerHTML =
        `<span>${msg.userId==="System"?"üëã Welcome":msg.userId}</span>
         <span>${msg.timestamp||""}</span>`;

    let body = document.createElement("div");
    body.textContent = msg.text;

    b.appendChild(meta);
    b.appendChild(body);
    row.appendChild(b);
    messages.appendChild(row);

    messages.scrollTop = messages.scrollHeight;
});

/* ONLINE LIST POPUP */
const onlinePopup = document.getElementById("onlinePopup");

onlineCount.onclick = ()=>{
    onlinePopup.style.display =
        onlinePopup.style.display==="block"?"none":"block";
};

socket.on("onlineList",(list)=>{
    onlinePopup.innerHTML = "";
    list.forEach(u=>{
        let d = document.createElement("div");
        d.textContent = u;
        onlinePopup.appendChild(d);
    });
    onlineCount.textContent = list.length + " online";
});

/* JOIN / LEAVE EVENT */
socket.on("userJoinedEvent",(uid)=>{
    let e=document.createElement("div");
    e.className="event";
    e.textContent = "üü¢ "+uid+" joined";
    messages.appendChild(e);
});

socket.on("userLeftEvent",(uid)=>{
    let e=document.createElement("div");
    e.className="event";
    e.textContent = "üî¥ "+uid+" left";
    messages.appendChild(e);
});

</script>

</body>
</html>
